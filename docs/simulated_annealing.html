<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="ja">
<head>
<link rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" href="css/style2.css" type="text/css">
<meta name="keywords" content="keyboard, layout, typing, effort, qwerty, dvorak, colemak, arensito, capewell, best layout, worst layout, custom layout, simulated annealing, monte carlo, simulation">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Carpalx - keyboard layout optimizer</title>

<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans:400,700,800|PT+Serif:400,400italic,700|Inconsolata:400,700">

</head>

<body>

<div id="body">

<div id="page">

<div id="masthead">
<a href="index.html"><img src="images/carpalx-logo-v3-crop.png" alt="carpalx - keyboard layout optimizer - save your carpals"></a>
</div>


<div id="leftpane">

<div id="slogan">



<p title="Carpalx optimizes keyboard layouts to create ones that require less effort and significantly reduced carpal strain!">Carpalx はキーボード配列を最適化することで労力を減らし、手の負担を激減させる配列を作るプロジェクトです！

<p><a href="full_optimization.html"><img src="images/carpalx-ourbest.png"></a>
<p><a href="worst_layout.html"><img src="images/carpalx-ourworst.png"></a>

<p title="Download keyboard layouts, or run the code yourself to explore new layouts."><img src="images/download.png" style="float:left; padding: 0 0.25em 0 0;"><a href="download.html">完成した配列をダウンロード</a>してもいいし、<a href="requirements.html">自分でこのコードを使って</a>新配列の探求へ挑むのもオツでしょう。

<p title="X11 layouts are available! Patches to include Carpalx layouts in xkeyboard-config and kbd have been submitted by Perry Thompson. Meanwhile, many thanks to Sven Hallberg for providing X11 configuration for Carpalx layouts. Richard Gomes contributed an archive of these files for KDE/Gnome users."><img src="images/x.png" style="float:left; padding: 0 0.25em 0 0;"><b>X11 用定義、あります！</b> Perry Thompson 氏が <a href="https://www.freedesktop.org/wiki/Software/XKeyboardConfig/">xkeyboard-config</a> と <a href="http://kbd-project.org/">kbd</a> に Carpalx の配列を含めるパッチを送ってくれました。また、<a href="http://www.khjk.org/log/2011/jan/carpalx.html">Carpalx の配列の X11 設定</a>を提供してくれた Sven Hallberg 氏に感謝。Richard Gomes 氏には KDE/Gnome ユーザ向けの<a href="http://mkweb.bcgsc.ca/carpalx/distribution/carpalx-x11.zip">アーカイブ</a>を提供頂きました。

<p title="Love your coworkers? Switch them to QWKRFY layout or a fully optimized QGMLWY layout."><img src="images/happy.png" style="float:left; padding: 0 0.25em 0 0;">好きな子には <a href="partial_optimization.html">QWKRFY 配列</a>か、ガチに最適化された <a href="full_optimization.html">QGMLWY 配列</a>を勧めちゃおう。

<p title="Hate your coworkers? Switch them to TNWMLC layout. It's the only keyboard layout that has its own fashion line."><img src="images/sad.png" style="float:left; padding: 0 0.25em 0 0;">逆にムカつく奴にゃ <a href="worst_layout.html">TNWMLC 配列</a>、これだね。<a href="http://fashionnotebook.wordpress.com/2011/01/04/julia-valle-tnwmlc/">ファッションになってる</a>唯一の配列だし。

<p title="Have ideas? Tell me.">なんかアイデアあったら<a href="mailto:martin.krzywinski@gmail.com">教えてくれよな</a>。<br><span style="color:green;font-size:90%">≪訳注：メールアドレスは原文著者のもの。連絡するなら英語でね。≫</span>

</div>

<div id="menu">


<h1>carpalx</h1>
<a href="index.html" title="home">ホーム</a>
<a href="about.html" title="about">概略</a>
<a href="typing_effort.html" title="typing effort">打鍵負担モデル</a>
<a href="model_parameters.html" title="model parameters">モデルのパラメータ</a>
<a href="keyboard_evaluation.html" title="keyboard evaluation">配列の評価</a>
<a href="keyboard_layouts.html" title="keyboard layouts">実配列のデータ</a>
<h1 title="case studies">実例</h1>
<a href="qwerty.html">QWERTY</a>
<a href="dvorak.html">Dvorak</a>
<a href="colemak.html">Colemak</a>
<a href="popular_alternatives.html" title="Popular alternatives">その他</a>
<h1 title="optimization">最適化</h1>
<a href="partial_optimization.html" title="Partial optimization">部分最適化</a>
<a href="full_optimization.html" title="Full optimization">完全最適化</a>
<a href="worst_layout.html" title="Worst Layout">最悪の配列</a>
<a href="component_optimization.html" title="Component optimization">要素別最適化</a>
<a href="improving_colemak.html" title="Improving colemak">Colemak を超えていけ</a>
<a href="de_correspondent.html" title="De Correspondent">オランダ語に挑む</a>
<h1 title="tutorials">チュートリアル</h1>
<a class=current href="simulated_annealing.html" title="simulated annealing">焼きなまし法 (SA)</a>
<a href="carpalx_installation.html" title="carpalx installation">Carpalx のインストール</a>
<a href="keyboard_statistics.html" title="keyboard statistics">配列の統計方法</a>
<a href="word_statistics.html" title="word statistics">ワードの統計方法</a>
<a href="basic_optimization.html" title="basic optimization">基本的な最適化</a>
<a href="concurrent_optimization.html" title="concurrent optimization">並行処理</a>
<a href="keyboard_images.html" title="keyboard images">配列画像の出力</a>
<a href="interpreting_optimization.html" title="interpreting optimization">結果の解釈</a>
<h1 title="documentation">ドキュメント</h1>
<a href="readme.html" title="README">README</a>
<a href="changes.html" title="CHANGES">変更履歴</a>
<a href="man_page.html" title="man page">man page</a>
<h1 title="download">ダウンロード</h1>
<a href="requirements.html" title="requirements">動作環境</a>
<a href="download.html" title="download">ダウンロード</a>
<h1 title="author">著者について</h1>
<a href="contact.html" title="contact">連絡先</a>
<a href="other_projects.html" title="other projects">他プロジェクト</a>
<a href="https://github.com/stak/carpalx-ja/" style="color:green;">日本語訳について</a>



</div>


<div id="footer" title="Carpalx is licensed under GPL. It is free, freely distributable and yours to modify under the auspices of the GPL license.">Carpalx は GPL のもとにライセンスされています。GPL に従う限りにおいて、無料で使用でき、自由に改変・再配布することができます。</div>


</div>
</div>

<div id="rightpane">




<div class=update>
<p title="16/aug/16 &mdash; Ergonomic Keyboard Layout Designed for the Filipino Language at AHFE2016 derives layout for Filipino language using Carpalx">2016/08/16 &mdash; Carpalx で作られた配列をもとにした<a href="http://link.springer.com/chapter/10.1007/978-3-319-41694-6_41">フィリピン語用のエルゴノミクスキーボード配列</a>が、国際学会 <a href="http://www.ahfe2016.org/program1.html">AHFE2016</a> で発表されました。
<p title="18/apr/16 &mdash; Carpalx layouts soon to appear in freedesktop (package xkeyboard-config) and kbd. Thanks to Perry Thompson.">2016/04/18 &mdash; Perry Thompson 氏のおかげで、Carpalx の配列が freedesktop (xkeyboard-config パッケージ) と kbd に含まれるようになります。
<p title="9/sep/14 &mdash; A new layout&mdash;De Correspondent&mdash;for the Dutch language in collaboration with De Correspondent.">2014/09/09 &mdash; <a href="https://decorrespondent.nl/en">De Correspondent 社</a>と共同で、オランダ語用の新しい配列 <a href="de_correspondent.html">De Correspondent</a> を作りました。
<p title="16/may/14 &mdash; Added evaluation of the Norman layout. This layout modifies 14/26 keys and has statistics similar to Colemak. Detailed statistics are available.">2014/05/16 &mdash; <a href="http://www.normanlayout.info">Norman 配列</a>の<a href="full_optimization.html">評価値</a>を追加しました。この配列は 26 キー中の 14 キーを入れ替えて Colemak 同等の統計的性能を持ちます。<a href="keyboard_layouts.html">詳細な統計データ</a>もあります。
<p title="12/feb/14 &mdash; Added evaluationof the abKey layout. Its alphabetic layout makes no attempt at ergonomics. Detailed statistics are available.">2014/02/12 &mdash; <a href="http://www.cnet.com.au/from-qwerty-to-abkey-240003768.htm">abKey 配列</a>の<a href="popular_alternatives.html">評価値</a>を追加しました。ただしエルゴノミクス的側面の評価を試みてはいません。<a href="keyboard_layouts.html">詳細な統計データ</a>もあります。
</div>


<h1>
Simulated Annealing
</h1>







<div id="toc">
<p><b>ON THIS PAGE</b></p>
<ul>

<a href="simulated_annealing.html#stochastic_optimization"><li>stochastic optimization</li></a>

<a href="simulated_annealing.html#simulated_annealing"><li>simulated annealing</li></a>

<a href="simulated_annealing.html#parameter_values"><li>parameter values</li></a>

<a href="simulated_annealing.html#references"><li>references </li></a>


</ul>
</div>






<a name="stochastic_optimization"></a><h2>Stochastic Optimization</h2>

<p>Stochastic methods are used when it is very difficult,
or impossible, to analytically (or deterministically) find the "best solution" to a
problem. These kinds of problems are called np-complete (or np-hard) &mdash; you
must examine all solutions in order to be assured of having found the best solution.

<p>Identifying all potential solutions to a problem is not practical,
except for the simplest problems. If you consider something like a
keyboard layout for a keyboard with only 26 keys, it quickly becomes
apparent that exploring all potential layouts (26! =
4x10<sup>26</sup>) is not feasible. However, the problem is made
tractable by the fact that given two layouts you can determine which
of the two is better. Moreover, if you think about it a little bit you
can probably come up with some kind of number which quantifies the
fitness of a given layout. In your search for the best layout, you would examine a variety of layouts and consider only those that had the best fitness.

<p>The 'stochastic' part of the optimization represents the use of random numbers in the process of finding the best layout. Randomness is used to generate new layouts based on the last best solution. Randomness is also used to determine whether a candidate solution is to be accepted (read below). The optimization is therefore not deterministic (it doesn't always give you the same solution, as long as the seed to the random number generator is different). 

<p>Usually multiple runs of the simulation are necessary to explore the family of solutions to identify the best one because the phase space of solutions is generally complicated and many local minima exist.



<a name="simulated_annealing"></a><h2>Simulated Annealing</h2>

<p>Simulated annealing is one of many types of stochastic optimization
algorithms. Because simulated annealing has its roots in physics, the
quantity that measures a solution's fitness is frequently refered to
as the energy. The algorithm's role is to therefore find the solution
for which the energy is minimum. The process of finding this solution
begins with starting with some initial guess, which is frequently a
random state.

<p>For example, you would start with a keyboard layout on which the
keys are randomly organized. Since each potential solution has an
associated energy, you compute the energy (E<sub>0</sub>) and set this
value aside. Next, you adjust the solution slightly to obtain a
marginally different solution. The size of this adjustment is
cruicial. If the step is too small, it make take forever to move to a
significantly different state. If the step is too large, you risk
jumping about the solution space so quickly that you will not converge
to a solution. In the case of the keyboard, a reasonable step from one
solution to another is a single or double keys swap. Once the new
solution has been derived, you compute its energy (E<sub>1</sub>).

<p>Now that you have E<sub>0</sub> and E<sub>1</sub> is where things
get interesting. Let dE = E<sub>1</sub> - E<sub>0</sub> (I am using dE
loosely here - it's not a differential quantity but just a
difference). You might suppose that if dE < 0 then you should value
the new solution over the old one, since its energy is lower. You'd be
right - in this case, simulated annealing transitions to the new
solution and continues from there. Let's skip over the dE = 0 case for
now. What about when dE > 0? In this case, the new solution is less
desirable than the old one, since its energy is higher. Do we discard
the new solution? Let's consider what would happen if we did.

<p>If all transitions with dE > 0 are rejected, the algorithm will be
greedy and descend towards the lowest-energy solution in the vicinity
of the current state. If the step from one solution to another is
small, then a minimum energy state will be found. However, this may be
a local minimum instead of a global one. If all paths from the local
minimum to the global minimum involve an increase in energy (imagine
the local minimum being a trough), these paths will never be
explored. To mitigate this, and this is where the "stochastic" part of
simulated annealing comes into play, the algorithm probabilistically
accepts transitions associated with dE > 0 according to the following
probability

<p><img src="images/sa-eq01.png">

<p>where dE is the energy difference and T is a parameter that is
interpreted as a temperature. The basis for this interpretation
originates from the original motivation for the form of of the
transition probability. 

<p>Given a candidate transition and dE > 0, the algorithm samples a
uniformly distributed random number r in the range [0,1) and if r<p,
then performs the transition and accepts the higher energy state. If
dE is very large, p is small and this transition does not happen
frequently. If dE is small, then this transition is more frequent. 

<p><img src="images/sa-eq02.png">

<p>The role of the parameter T is very important in the probability
equation. This parameter is continuously adjusted during the
simulation (typically monotonically decreased). The manner in which
this parameter is adjusted is called the cooling schedule, again with
the interpration of T as a temperature. Initially, T is large thereby
allowing transitions with a large dE to be accepted. As the simulation
progresses, T is made smaller, thereby reducing the size of excursion
in to higher energy solutions. Towards the end of the simulation, T is
very small and transitions with only very slight increases in E are
allowed.

<p>In carpalx, T is cooled exponentially as a function of the
iteration, i.

<p><img src="images/sa-eq03.png">

<p>The exponential form of T(i) has nothing to do with the exponential
form of the transition probability. It's just a cooling schedule that
I adapted, admittedly without testing any other form.

<p>The effect of the cooling schedule is to allow the algorithm
freedom of movement throughout the solution space at first (large T),
then progressively converge to a solution with a minimum (medium T)
and converge to a minimum (small T). The optimization simulation is typically run
many times, each time with a different starting state. 



<a name="parameter_values"></a><h2>Parameter Values</h2>

<p>Choosing values for p<sub>0</sub>, T<sub>0</sub>, k
and N should be done carefully. The possible range of values for E
must be anticipated and T will need to be scaled appropriately to
produce useful probability values.




<div class="pullrimg" style="width: 620">
<img  src="images/tmp-oovxkx-plot-3.png">
<div class="caption"><b>Figure 1</b> | Cooling schedule for the optimization. As the optimization runs, the probability of accepting a less desirable layout exponentially decreases.</div>
</div>


<p>For carpalx, the typing effort ranges from 9 (QWERTY, mod_01) to
about 4.5-5 (optimized, mod_01). Consequently, I have chosen the
parameters as follows

<ul>
<li>T<sub>0</sub> = 10
<li>k = 10
</ul>

<p>T<sub>0</sub> scales the temperature so that at maximum energy, E/T
is approximately 1. With a value of k=10, the temperature drops by 1/e
for every 1/10th of the simulation. Initially, the temperature is
T(i=0) = 10. At i=1000, (1/10th of the simulation), T(1000)=10/e. At
i=2000, (2/10th of the simulation), T(2000)=10/e<sup>2</sup>, and so
on. At the end of the simulation, T(end) = 10/e<sup>10</sup> =
4.5x10<sup>-4</sup>. If you want the temperature to drop faster, use a
larger value of k. To start with a cooler system, set a lower T<sub>0</sub>.

<p>For all simulations, I've used

<ul>
<li>p<sub>0</sub> = 1
<li>N = 10000
</ul>



<a name="references"></a><h2>References </h2>

<p>Metropolis,N., A. Rosenbluth, M. Rosenbluth, A. Teller, E. Teller,
"<a href="http://mkweb.bcgsc.ca/papers/metropolis-montecarlo.pdf">Equation of State Calculations by Fast Computing Machines</a>",
J. Chem. Phys.,21, 6, 1087-1092, 1953.
<br><i>The canonical reference on Monte Carlo simulations.</i>
<p>Kirkpatrick, S., C. D. Gelatt Jr., M. P. Vecchi, "<a href="http://mkweb.bcgsc.ca/papers/kirkpatrick-simulatedannealing.pdf">Optimization by
Simulated Annealing</a>",Science, 220, 4598, 671-680, 1983.
<br><i>The canonical reference for simulated annealing.</i>
<p>Cerny, V., "<a href="http://mkweb.bcgsc.ca/papers/cerny-travelingsalesman.pdf">Thermodynamical Approach to the Traveling Salesman
Problem: An Efficient Simulation Algorithm</a>", J. Opt. Theory Appl., 45,
1, 41-51, 1985 
<br><i>Application of simulated annealing to traveling salesman problem.</i>
<p><a
href="http://library.lanl.gov/cgi-bin/getfile?00326886.pdf">Metropolis,
Monte Carlo and the MANIAC.</a>
<br><i>Fun article.</i>
<p><a
href="http://en.wikipedia.org/wiki/Simulated_annealing">simulated
annealing on wikipedia</a>
<p><a
href="http://mathworld.wolfram.com/SimulatedAnnealing.html">simulated
annealing on mathworld</a>


<!--
<div class=technical>
If you don't get the relative path right, carpalx will complain. For example if you use -keyboard_input out/tutorials/04/tmp-oovxkx.conf, the following message will appear
<br><br>
cannot file keyboard definition - /home/martink/work/perl/keyboard/carpalx-0.10/etc/out/tutorials/04/tmp-oovxkx.conf at bin/carpalx line 1453.
<br><br>
Based on the message, it's easy to correct the input path.
</div>
-->




<br clear=both>
</div>



<div id="copyright">
Carpalx | keyboard layout optimizer | <a href="http://mkweb.bcgsc.ca/carpalx">ホーム</a> | &copy; 2005-2014 <a href="mailto:martink@bcgsc.ca">Martin Krzywinski</a> | <a href="http://mkweb.bcgsc.ca">他のプロジェクト</a>
</div>

</div>

</div>

<!-- script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script -->
<!-- script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-10760878-1");
pageTracker._trackPageview();
} catch(err) {}</script -->
<a href="https://github.com/stak/carpalx-ja"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"></a>

</body>
</html>


